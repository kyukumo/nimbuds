var e=(t=>(t.Dark="dark",t.Earth="earth",t.Fire="fire",t.Light="light",t.Water="water",t.Wind="wind",t))(e||{}),a=(t=>(t.Blaze="blaze",t.Blossom="blossom",t.Breeze="breeze",t.Cascade="cascade",t.Drench="drench",t.Eclipse="eclipse",t.Flower="flower",t.Gleam="gleam",t.Gloom="gloom",t.Gust="gust",t.Ignite="ignite",t.Inferno="inferno",t.Seed="seed",t.Shade="shade",t.Soak="soak",t.Starfall="starfall",t.Tornado="tornado",t.Twinkle="twinkle",t))(a||{}),I=(t=>(t.Four="Four",t.Three="Three",t.Two="Two",t))(I||{}),m=(t=>(t.Train="train",t.Battle="battle",t))(m||{});const T=100,k=["amazwing","cherubud","flagoon","flarva","flitten","galephin","gloominnow","lopilot","luxureef","meadowisp","nebulon","oakindle","silten","smoldit","snakelit","specalf","spookecko","sproutide","voidixie","windeed","wispyre"],F={spookecko:{advantage:[],ascends:3,description:"This mysterious and eerie reptile lurks in the shadows, using its ghastly powers to frighten and confuse opponents.",disadvantage:[e.Light],element:[e.Dark],id:"spookecko",moves:[a.Gloom],name:"Spookecko",next:"shadile",stage:1,stats:{attack:2,defense:2,speed:1},tile:{x:0,y:0}},shadile:{advantage:[],ascends:4,description:"It lurks in the depths of the night, preying on the fears and weaknesses of its opponents with its sinister powers.",disadvantage:[e.Light],element:[e.Dark],id:"shadile",moves:[a.Shade],name:"Shadile",next:"spectraptor",previous:"spookecko",stage:2,stats:{attack:3,defense:2,speed:1},tile:{x:10,y:0}},spectraptor:{advantage:[],description:"If you feel a sudden chill, you may be experiencing the ghostly aura of this sinister raptor, silently stalking its prey.",disadvantage:[e.Light],element:[e.Dark],id:"spectraptor",moves:[a.Eclipse],name:"Spectraptor",previous:"shadile",stage:3,stats:{attack:4,defense:3,speed:1},tile:{x:20,y:0}},smoldit:{advantage:[e.Wind],ascends:7,description:"The smoldering embodiment of lingering spectral energy.",disadvantage:[e.Light,e.Water],element:[e.Dark,e.Fire],id:"smoldit",moves:[a.Blaze],name:"Smoldit",next:"embergeist",stage:1,stats:{attack:1,defense:1,speed:3},tile:{x:0,y:20}},embergeist:{advantage:[e.Wind],description:"Flickering, mysterious flames that haunt their surroundings with an ominous presence.",disadvantage:[e.Light,e.Water],element:[e.Dark,e.Fire],id:"embergeist",moves:[a.Inferno],name:"Embergeist",previous:"smoldit",stage:2,stats:{attack:2,defense:3,speed:4},tile:{x:10,y:20}},specalf:{advantage:[e.Water],ascends:5,description:"Awaiting the return of its doting parent, this bovine animal conceals itself beneath a veil of spectral flora.",disadvantage:[e.Light,e.Wind],element:[e.Dark,e.Earth],id:"specalf",moves:[a.Shade,a.Flower],name:"Specalf",next:"thornox",stage:1,stats:{attack:2,defense:3,speed:1},tile:{x:0,y:40}},thornox:{advantage:[e.Water],description:"It seeks to exact revenge on anyone it can find using its razor-sharp thorns.",disadvantage:[e.Light,e.Wind],element:[e.Dark,e.Earth],id:"thornox",moves:[a.Eclipse,a.Blossom],name:"Thornox",previous:"specalf",stage:2,stats:{attack:3,defense:4,speed:2},tile:{x:10,y:40}},voidixie:{advantage:[],ascends:7,description:"Few have witnessed its otherworldly aura, professing conflicting feelings of curiosity and trepidation.",disadvantage:[e.Dark,e.Light],element:[e.Dark,e.Light],id:"voidixie",moves:[a.Shade,a.Gleam],name:"Voidixie",next:"faeclipse",stage:1,stats:{attack:2,defense:1,speed:2},tile:{x:0,y:60}},faeclipse:{advantage:[],description:"Hauntingly sinister, menacing, and alluring. It has an aura of cosmic destruction.",disadvantage:[e.Dark,e.Light],element:[e.Dark,e.Light],id:"faeclipse",moves:[a.Eclipse,a.Starfall],name:"Faeclipse",previous:"voidixie",stage:2,stats:{attack:4,defense:1,speed:3},tile:{x:10,y:60}},gloominnow:{advantage:[e.Fire],ascends:5,description:"A glint from its shimmering, iridescent scales will catch your eye from deep below the waters.",disadvantage:[e.Earth,e.Light],element:[e.Dark,e.Water],id:"gloominnow",moves:[a.Gloom,a.Soak],name:"Gloominnow",next:"barrabyss",stage:1,stats:{attack:1,defense:1,speed:2},tile:{x:0,y:80}},barrabyss:{advantage:[e.Fire],ascends:8,description:"Be careful where you swim. Legend has it that when you see its eerie, glowing eyes, it's already too late for you.",disadvantage:[e.Earth,e.Light],element:[e.Dark,e.Water],id:"barrabyss",moves:[a.Shade,a.Drench],name:"Barrabyss",next:"umbracuda",previous:"gloominnow",stage:2,stats:{attack:2,defense:1,speed:3},tile:{x:10,y:80}},umbracuda:{advantage:[e.Fire],description:"Its sleek, etherial fins cascade through the water, appearing in and vanishing from the ocean at will.",disadvantage:[e.Earth,e.Light],element:[e.Dark,e.Water],id:"umbracuda",moves:[a.Eclipse,a.Cascade],name:"Umbracuda",previous:"barrabyss",stage:3,stats:{attack:4,defense:1,speed:4},tile:{x:20,y:80}},nebulon:{advantage:[e.Earth],ascends:6,description:"Often mistaken for an unidentified flying object, it has a markedly unassuming face.",disadvantage:[e.Fire,e.Light],element:[e.Dark,e.Wind],id:"nebulon",moves:[a.Shade,a.Gust],name:"Nebulon",next:"nebulisk",stage:1,stats:{attack:1,defense:4,speed:2},tile:{x:0,y:100}},nebulisk:{advantage:[e.Earth],description:"Seemingly extraterrestrial, it is highly skilled in piloting its sleek spacecraft.",disadvantage:[e.Fire,e.Light],element:[e.Dark,e.Wind],id:"nebulisk",moves:[a.Eclipse,a.Tornado],name:"Nebulisk",previous:"nebulon",stage:2,stats:{attack:3,defense:3,speed:3},tile:{x:10,y:100}},snakelit:{advantage:[e.Wind],ascends:4,description:"An emerald, fiery glow emits from this serpentine creature.",disadvantage:[e.Water],element:[e.Fire],id:"snakelit",moves:[a.Ignite],name:"Snakelit",next:"serpyro",stage:1,stats:{attack:2,defense:2,speed:2},tile:{x:0,y:120}},serpyro:{advantage:[e.Wind],ascends:8,description:"It uses the scorching jade flames emitting from its tail to extinguish its opponents.",disadvantage:[e.Water],element:[e.Fire],id:"serpyro",moves:[a.Blaze],name:"Serpyro",next:"pyroconda",previous:"snakelit",stage:2,stats:{attack:3,defense:2,speed:3},tile:{x:10,y:120}},pyroconda:{advantage:[e.Wind],description:"Majestic, some consider it a deity. Its fiery plumage exudes power and grace.",disadvantage:[e.Water],element:[e.Fire],id:"pyroconda",moves:[a.Inferno],name:"Pyroconda",previous:"serpyro",stage:3,stats:{attack:4,defense:2,speed:4},tile:{x:20,y:120}},oakindle:{advantage:[e.Water,e.Wind],ascends:5,description:"A small seedling engulfed in flames.",disadvantage:[],element:[e.Earth,e.Fire],id:"oakindle",moves:[a.Flower,a.Blaze],name:"Oakindle",next:"torchwood",stage:1,stats:{attack:3,defense:1,speed:1},tile:{x:0,y:140}},torchwood:{advantage:[e.Water,e.Wind],description:"It is fiercely loyal to mother nature, using her powers to protect those it considers vulnerable.",disadvantage:[],element:[e.Earth,e.Fire],id:"torchwood",moves:[a.Blossom,a.Inferno],name:"Torchwood",previous:"oakindle",stage:2,stats:{attack:4,defense:1,speed:1},tile:{x:10,y:140}},wispyre:{advantage:[e.Wind],description:"It's playful and mischievous, dazzling its opponents with sublime flames and whimsical charm.",disadvantage:[e.Dark,e.Water],element:[e.Fire,e.Light],id:"wispyre",moves:[a.Inferno,a.Starfall],name:"Wispyre",stage:1,stats:{attack:4,defense:3,speed:4},tile:{x:0,y:160}},flagoon:{advantage:[e.Fire,e.Wind],ascends:4,description:"It releases infernal steam to drive intruders away from its den.",disadvantage:[e.Earth],element:[e.Fire,e.Water],id:"flagoon",moves:[a.Ignite,a.Soak],name:"Flagoon",next:"blazesea",stage:1,stats:{attack:1,defense:2,speed:3},tile:{x:0,y:180}},blazesea:{advantage:[e.Fire,e.Wind],ascends:8,description:"It is widely known that Blazesea should not be approached. It unceasingly combusts as it maintains a cooling aura of water around its body.",disadvantage:[e.Earth],element:[e.Fire,e.Water],id:"blazesea",moves:[a.Blaze,a.Drench],name:"Blazesea",next:"infernocean",previous:"flagoon",stage:2,stats:{attack:3,defense:1,speed:2},tile:{x:10,y:180}},infernocean:{advantage:[e.Fire,e.Wind],description:"It is described as titanic, commanding the destructive power of roaring tides and wildfire.",disadvantage:[e.Earth],element:[e.Fire,e.Water],id:"infernocean",moves:[a.Inferno,a.Cascade],name:"Infernocean",previous:"blazesea",stage:3,stats:{attack:4,defense:2,speed:1},tile:{x:20,y:180}},flarva:{advantage:[e.Earth,e.Wind],ascends:3,description:"On a clear summer night, you can see the faint blue glow of Flarva swarming on the trees.",disadvantage:[e.Water],element:[e.Fire,e.Wind],id:"flarva",moves:[a.Ignite,a.Breeze],name:"Flarva",next:"chrysfire",stage:1,stats:{attack:1,defense:2,speed:1},tile:{x:0,y:200}},chrysfire:{advantage:[e.Earth,e.Wind],ascends:6,description:"Its shell is warm to the touch. Wildfire experts relocate Chrysfire away from forests before they hatch.",disadvantage:[e.Water],element:[e.Fire,e.Wind],id:"chrysfire",moves:[a.Blaze,a.Gust],name:"Chrysfire",next:"ignimoth",previous:"flarva",stage:2,stats:{attack:2,defense:4,speed:1},tile:{x:10,y:200}},ignimoth:{advantage:[e.Earth,e.Wind],description:"It flutters, trailed by delicate blue sparks. Many Chrysfire do not survive relocation, so it is said that an Ignimoth sighting brings one good luck.",disadvantage:[e.Water],element:[e.Fire,e.Wind],id:"ignimoth",moves:[a.Inferno,a.Tornado],name:"Ignimoth",previous:"chrysfire",stage:3,stats:{attack:4,defense:1,speed:2},tile:{x:20,y:200}},meadowisp:{advantage:[e.Water],description:"A stoic spirit of nature. If you look closely, you can find it tailing far behind you as you walk the forest trails.",disadvantage:[e.Wind],element:[e.Earth],id:"meadowisp",moves:[a.Blossom],name:"Meadowisp",stage:1,stats:{attack:4,defense:4,speed:1},tile:{x:0,y:220}},cherubud:{advantage:[e.Water],ascends:5,description:"It has a serene nature and captivating aroma that will bring peace to anyone in its presence.",disadvantage:[e.Dark,e.Wind],element:[e.Earth,e.Light],id:"cherubud",moves:[a.Flower,a.Gleam],name:"Cherubud",next:"angelily",stage:1,stats:{attack:1,defense:2,speed:2},tile:{x:0,y:240}},angelily:{advantage:[e.Water],description:"Its many faces resemble flowers that radiate a pure and heavenly aura. Culturally, it symbolizes a return to happiness.",disadvantage:[e.Dark,e.Wind],element:[e.Earth,e.Light],id:"angelily",moves:[a.Blossom,a.Starfall],name:"Angelily",previous:"cherubud",stage:2,stats:{attack:2,defense:3,speed:3},tile:{x:10,y:240}},sproutide:{advantage:[e.Fire,e.Water],ascends:7,description:"A playful dragon hatchling born from a river, embodying the energy of nature.",disadvantage:[e.Wind],element:[e.Earth,e.Water],id:"sproutide",moves:[a.Flower,a.Drench],name:"Sproutide",next:"floriver",stage:1,stats:{attack:2,defense:1,speed:4},tile:{x:0,y:260}},floriver:{advantage:[e.Fire,e.Water],description:"A revered deity of the river. It manipulates the flow of water where it swims, growing lily pads in its wake.",disadvantage:[e.Wind],element:[e.Earth,e.Water],id:"floriver",moves:[a.Blossom,a.Cascade],name:"Floriver",previous:"sproutide",stage:2,stats:{attack:4,defense:2,speed:2},tile:{x:10,y:260}},windeed:{advantage:[e.Earth,e.Water],ascends:7,description:"It hides among planted beetroots, zipping into the sky before it is picked.",disadvantage:[e.Fire],element:[e.Earth,e.Wind],id:"windeed",moves:[a.Flower,a.Gust],name:"Windeed",next:"zephyroot",stage:1,stats:{attack:1,defense:3,speed:3},tile:{x:0,y:280}},zephyroot:{advantage:[e.Earth,e.Water],description:"A spring festival celebrates the migration of Zephyroot. They carry themselves on the air with a fan of leaves.",disadvantage:[e.Fire],element:[e.Earth,e.Wind],id:"zephyroot",moves:[a.Blossom,a.Tornado],name:"Zephyroot",previous:"windeed",stage:2,stats:{attack:2,defense:4,speed:4},tile:{x:10,y:280}},flitten:{advantage:[],ascends:7,description:"It's known for its mischievous, playful nature. It manipulates your dreams, hoping to be fed when you wake.",disadvantage:[e.Dark],element:[e.Light],id:"flitten",moves:[a.Gleam],name:"Flitten",next:"glimmew",stage:1,stats:{attack:3,defense:2,speed:2},tile:{x:0,y:300}},glimmew:{advantage:[],description:"Nocturnal, its luminescent fur glimmers in the moonlight, charming opponents with its graceful movements.",disadvantage:[e.Dark],element:[e.Light],id:"glimmew",moves:[a.Starfall],name:"Glimmew",previous:"flitten",stage:2,stats:{attack:4,defense:2,speed:3},tile:{x:10,y:300}},silten:{advantage:[e.Fire],ascends:4,description:"It posesses a protective shell that provides for it remarkable resilience and adaptability.",disadvantage:[e.Dark,e.Earth],element:[e.Light,e.Water],id:"silten",moves:[a.Twinkle,a.Soak],name:"Silten",next:"boglow",stage:1,stats:{attack:1,defense:3,speed:2},tile:{x:0,y:320}},boglow:{advantage:[e.Fire],ascends:7,description:"A tiny luminescent creature with a resilient body. It thrives in extreme aquatic environments.",disadvantage:[e.Dark,e.Earth],element:[e.Light,e.Water],id:"boglow",moves:[a.Gleam,a.Drench],name:"Boglow",next:"gleamoss",previous:"silten",stage:2,stats:{attack:2,defense:4,speed:2},tile:{x:10,y:320}},gleamoss:{advantage:[e.Fire],description:"Its shimmering moss-like exterior grants it the ability to regenerate and endure harsh environments. It is not visible to the naked eye.",disadvantage:[e.Dark,e.Earth],element:[e.Light,e.Water],id:"gleamoss",moves:[a.Starfall,a.Cascade],name:"Gleamoss",previous:"boglow",stage:3,stats:{attack:3,defense:4,speed:1},tile:{x:20,y:320}},amazwing:{advantage:[e.Earth],ascends:5,description:"Tales of cupid can usually be attributed to Amazwing. It spreads love and joy as it flies.",disadvantage:[e.Dark,e.Fire],element:[e.Light,e.Wind],id:"amazwing",moves:[a.Twinkle,a.Breeze],name:"Amazwing",next:"featherall",stage:1,stats:{attack:1,defense:1,speed:4},tile:{x:0,y:340}},featherall:{advantage:[e.Earth],ascends:8,description:"It enchants the hearts of those it pierces with its tail feathers.",disadvantage:[e.Dark,e.Fire],element:[e.Light,e.Wind],id:"featherall",moves:[a.Gleam,a.Gust],name:"Featherall",next:"enchantalon",previous:"amazwing",stage:2,stats:{attack:2,defense:2,speed:4},tile:{x:10,y:340}},enchantalon:{advantage:[e.Earth],description:"It is a graceful and affectionate parter, but it lulls its enemies into a false sense of security with its enchanting melodies.",disadvantage:[e.Dark,e.Fire],element:[e.Light,e.Wind],id:"enchantalon",moves:[a.Starfall,a.Tornado],name:"Enchantalon",previous:"featherall",stage:3,stats:{attack:3,defense:3,speed:4},tile:{x:20,y:340}},luxureef:{advantage:[e.Fire],ascends:7,description:"Vibrant coral climbs its body. It is capable of producing captivating displays of bioluminescence.",disadvantage:[e.Earth],element:[e.Water],id:"luxureef",moves:[a.Drench],name:"Luxureef",next:"coraluxe",stage:1,stats:{attack:2,defense:3,speed:2},tile:{x:0,y:360}},coraluxe:{advantage:[e.Fire],description:"It can manipulate the flow of water currents, which often results in conflict with Floriver. Whirlpools form where they clash.",disadvantage:[e.Earth],element:[e.Water],id:"coraluxe",moves:[a.Cascade],name:"Coraluxe",previous:"luxureef",stage:2,stats:{attack:3,defense:4,speed:3},tile:{x:10,y:360}},galephin:{advantage:[e.Earth,e.Fire],ascends:7,description:"Its sleek dolphin-like body allows it to soar through the sky. Funnel clouds form in its trail.",disadvantage:[],element:[e.Water,e.Wind],id:"galephin",moves:[a.Drench,a.Gust],name:"Galephin",next:"typhorca",stage:1,stats:{attack:3,defense:1,speed:3},tile:{x:0,y:380}},typhorca:{advantage:[e.Earth,e.Fire],description:"Gliding through the air with agility, it uses its windswept tail to create powerful gusts and summon storms at sea.",disadvantage:[],element:[e.Water,e.Wind],id:"typhorca",moves:[a.Cascade,a.Tornado],name:"Typhorca",previous:"galephin",stage:2,stats:{attack:3,defense:1,speed:4},tile:{x:10,y:380}},lopilot:{advantage:[e.Earth],ascends:7,description:"Its large ears allow it to effortlessly navigate the winds. Lost travelers are guided by Lopilot to safety.",disadvantage:[e.Fire],element:[e.Wind],id:"lopilot",moves:[a.Gust],name:"Lopilot",next:"aviare",stage:1,stats:{attack:2,defense:2,speed:3},tile:{x:0,y:400}},aviare:{advantage:[e.Earth],description:"A skilled pilot of the skies, it is rare to see Aviare on solid ground. Its fur has evolved to resemble fluffy clouds.",disadvantage:[e.Fire],element:[e.Wind],id:"aviare",moves:[a.Tornado],name:"Aviare",previous:"lopilot",stage:2,stats:{attack:3,defense:2,speed:4},tile:{x:10,y:400}}},U=({players:t})=>s=>{const n=t[s];n.cooldowns={}},G=(t=1)=>Math.ceil(t*2/5)+t+4,y=(t,s,n=[])=>{const i=[];for(let o=t;o<=s;o++)n.includes(o)||i.push(o);if(!i.length)return-1;const r=Math.floor(Math.random()*i.length);return i[r]},Y=(t,s)=>s,H=()=>Math.random()-.5,_=(t,s=10)=>{const n=Array(s).fill(null).map(Y);return n.sort(H),n.slice(0,t)},z=t=>{const s=k[t],n=F[s];return{...n,stats:{...n.stats,hp:G(1),level:1,xp:0}}},q=t=>k.indexOf(t),V=t=>{const s=(t==null?void 0:t.map(q))??[],n=y(0,k.length-1,s);return z(n)},X=(t=3)=>_(t,k.length).map(z),Z=()=>X(1),O={[a.Blaze]:{element:e.Fire,label:"Blaze",level:2},[a.Blossom]:{element:e.Earth,label:"Blossom",level:3},[a.Breeze]:{element:e.Wind,label:"Breeze",level:1},[a.Cascade]:{element:e.Water,label:"Cascade",level:3},[a.Drench]:{element:e.Water,label:"Drench",level:2},[a.Eclipse]:{element:e.Dark,label:"Eclipse",level:3},[a.Flower]:{element:e.Earth,label:"Flower",level:2},[a.Gleam]:{element:e.Light,label:"Gleam",level:2},[a.Gloom]:{element:e.Dark,label:"Gloom",level:1},[a.Gust]:{element:e.Wind,label:"Gust",level:2},[a.Ignite]:{element:e.Fire,label:"Ignite",level:1},[a.Inferno]:{element:e.Fire,label:"Inferno",level:3},[a.Seed]:{element:e.Earth,label:"Seed",level:1},[a.Shade]:{element:e.Dark,label:"Shade",level:2},[a.Soak]:{element:e.Water,label:"Soak",level:2},[a.Starfall]:{element:e.Light,label:"Starfall",level:3},[a.Tornado]:{element:e.Wind,label:"Tornado",level:3},[a.Twinkle]:{element:e.Light,label:"Twinkle",level:1}},L=30,v=({event:t,game:s,id:n})=>{const{events:i,players:r}=s;if(n){const o=r[n];o.events.length===L&&o.events.shift(),o.events.push(t)}else i.length===L&&i.shift(),i.push(t)},J=({event:t,game:s,id:n})=>{const i=l=>v({game:s,event:t,id:l}),{players:r}=s,o=Object.keys(r),d=o.indexOf(n);o.splice(d,1),o.forEach(i)},b=({events:t,game:s,id:n})=>{v({game:s,event:t.public}),v({game:s,event:t.player,id:n}),J({game:s,event:t.rival,id:n})},K=(t,s)=>n=>{const{players:i}=t,r=i[s];if(!r)return;const{target:o}=r;if(!o)return;const[d]=r.buds;if(!d)return;const{stats:l}=d,c=i[o];if(!(c!=null&&c.buds.length))return;const[g]=c.buds,{advantage:u,disadvantage:p,stats:h}=g,{hp:x=1,defense:W}=h,{attack:A}=l,{element:E,label:$}=O[n],B=u.includes(E),D=p.includes(E),R=y(0,255),P=y(0,2),S=R<=P;let f=A;B&&(f*=.5),D&&(f*=2),S&&(f*=1.5);const N=Math.ceil(f>=W?f*2-W:f*f/W);h.hp=x-N;const j=[`${d.name} used ${$} on ${g.name}!`,S&&"Critical hit!",B&&"It's ineffective...",D&&"It's effective!"].filter(Boolean).join(" ");v({event:j,game:t})},Q=1,M=(t,s)=>()=>{const{players:n}=t,i=n[s];if(!(i!=null&&i.buds.length))return;const[r]=i.buds,{moves:{length:o},name:d,stats:{level:l=1,xp:c=0}}=r;r.stats.xp=c+Q*(1/o);const g=Math.ceil((l*2-1)*1.2);r.stats.xp>=g&&(r.stats.level=l+1,r.stats.hp=G(r.stats.level),b({game:t,events:{player:`${d} leveled up to ${r.stats.level}!`,public:`${d} leveled up to ${r.stats.level}!`,rival:`Your rival's ${d} leveled up to ${r.stats.level}!`},id:s}))},ee=t=>(s,[n,{time:i,duration:r}])=>{const o=n;return t-i>=r?[...s,o]:s},te=t=>O[t].element,ae=(t,s)=>{const{duration:n,phase:i,players:r}=t,o=r[s];if(!o||!!!Object.keys(o.cooldowns).length)return;const l=ee(n),c=Object.entries(o.cooldowns).reduce(l,[]),g=p=>delete o.cooldowns[p];c.forEach(g);const u=c.map(te);if(i===m.Train){if(!(o!=null&&o.buds.length))return;const[{stats:{level:p=0}}]=o.buds;if(p<T){const x=M(t,s);c.forEach(x)}const{sounds:h}=o;o.sounds=[...h,...u]}else if(i===m.Battle){const p=K(t,s);c.forEach(p),t.sounds=[...t.sounds,...u]}},se=(t,s)=>{const{stats:{hp:n=0}}=s,{nextDefeatedBuds:i,nextBuds:r}=t;return n<=0?{...t,nextDefeatedBuds:[...i,s]}:{...t,nextBuds:[...r,s]}},ne=(t,s)=>{const{players:n}=t,i=n[s],{buds:r,defeatedBuds:o}=i,{nextBuds:d,nextDefeatedBuds:l}=[...r].reduce(se,{nextBuds:[],nextDefeatedBuds:[]});i.buds=d,i.defeatedBuds=[...o,...l],l.length&&(i.cooldowns={});const c=({name:g})=>{v({game:t,event:`${g} was defeated!`});const[u]=i.buds;u&&v({game:t,event:`${u.name} was called out!`})};l.forEach(c)},ie=({gameOver:t})=>t,re=(t,s)=>{const{[s]:n,...i}=t.players;if(!Object.values(i).every(ie)){const o=(n==null?void 0:n.buds.length)===0;o&&!n.gameOver&&v({game:t,event:"A rival wiped out!"}),n.gameOver=o}},oe=3,le=(t,s)=>{const{players:n}=t,i=n[s];if(i&&(i.lastEvent=t.duration,i.buds.length<oe)){const r=V(i.starters);i.buds=[...i.buds,r],i.starters=[...i.starters,r.id],b({game:t,events:{player:`You befriended ${r.name}!`,public:`${r.name} was befriended!`,rival:`Your rival befriended ${r.name}!`},id:s})}},de=(t,s)=>{const n=y(6e4,12e4),{duration:i,players:r}=t,o=r[s];if(!o)return;const{lastEvent:d}=o;i-d>n&&le(t,s)},w=(t,s)=>{const n=s.indexOf(t),i=[...s];i.splice(n,1);const r=y(0,i.length-1);return i[r]},ce=t=>(s,n)=>{const{gameOver:i}=t.players[n],r=i?"LOST":"WON";return{...s,[n]:r}},ge=t=>(s,n,i,r)=>{const o=s[n];return o.target===t&&(o.target=w(n,r)),s},pe=({players:t},s)=>n=>{const i=r=>{const o=t[r];o.target===n&&(o.target=w(r,s))};s.forEach(i)},C=(t,s)=>{const n=Z(),[{id:i}]=n;return{lastAction:0,buds:n,cooldowns:{},defeatedBuds:[],events:[],gameOver:!1,id:t,lastEvent:0,name:t,ping:0,sounds:[],stars:3e3,starters:[i],target:w(t,s)}},me=(t,s,n,i)=>({...t,[s]:C(s,i)}),ue=t=>(s,n)=>{ae(t,n);const{phase:i}=t;return i===m.Train?de(t,n):(ne(t,n),re(t,n)),t.players[n].gameOver?[...s,n]:s};Rune.initLogic({minPlayers:1,maxPlayers:4,setup:t=>({battleType:I.Four,duration:0,ended:!1,events:[],phase:m.Train,phases:{[m.Train]:60*3*1e3},players:t.reduce(me,{}),playerIds:t,sounds:[]}),events:{playerJoined:(t,{game:{players:s,playerIds:n}})=>{if(n.push(t),s[t]=C(t,n),n.length>1){const[i]=n,r=s[i];r.target||(r.target=w(i,n))}},playerLeft:(t,{game:s})=>{const{playerIds:n,players:i}=s,r=n.indexOf(t);n.splice(r,1),delete i[t];const o=ge(t);s.players=n.reduce(o,i)}},actions:{attack:({move:t,speed:s},{game:n,playerId:i})=>{const r=(6-s)*1e3,{phase:o,players:d}=n,l=d[i];if(!l)return;const c=Rune.gameTime();if(l.lastAction=c,o===m.Train){const g=l.cooldowns[t]??{duration:r};l.cooldowns[t]={...g,time:c}}else l.cooldowns={[t]:{duration:r,time:c}}},clearSounds:({sounds:t},{game:s,playerId:n})=>{const{phase:i,players:r,sounds:o}=s,d=l=>!t.includes(l);if(i===m.Battle)s.sounds=o.filter(d);else{const l=r[n],{sounds:c}=l;l.sounds=c.filter(d)}},ascend:(t,{game:s,playerId:n})=>{const{players:i}=s,r=i[n];if(!r)return;const[o]=r.buds;if(!o)return;const{ascends:d=T,next:l}=o;if(!l)return;const{stats:{hp:c,level:g=1,xp:u}}=o;if(g<d)return;const p={...F[l],stats:{...F[l].stats,hp:c,level:g,xp:u}};r.buds[0]=p,r.cooldowns={};const h=`${o.name} ascended to ${p.name}!`;b({game:s,events:{player:h,public:h,rival:`Your rival's ${o.name} ascended to ${p.name}!`},id:n})},switch:(t,{game:s,playerId:n})=>{const{players:i}=s,r=i[n],{cooldowns:o}=r;if(!!Object.keys(o).length)return;const l=r.buds.shift();if(l){r.buds.push(l);const[c]=r.buds,g=`${l==null?void 0:l.name} switched with ${c==null?void 0:c.name}!`;b({game:s,events:{player:g,public:g,rival:`Your rival's ${g}`},id:n})}},target:({target:t},{game:s,playerId:n})=>{s.players[n].target=t}},update:({allPlayerIds:t,game:s})=>{s.duration=Rune.gameTime();const{duration:n,phases:{[m.Train]:i}}=s;if(n===i){s.phase=m.Battle;const d=U(s);s.playerIds.forEach(d)}const r=ue(s),o=t.reduce(r,[]);if(s.phase===m.Battle)if(o.length===t.length-1){s.ended=!0;const l=ce(s);Rune.gameOver({players:t.reduce(l,{})})}else{const l=pe(s,t);o.forEach(l)}}});export{I as B,e as E,m as P,F as b,G as g,O as m};
