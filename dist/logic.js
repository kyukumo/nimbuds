var e=(t=>(t.Dark="dark",t.Earth="earth",t.Fire="fire",t.Light="light",t.Water="water",t.Wind="wind",t))(e||{}),s=(t=>(t.Blaze="blaze",t.Blossom="blossom",t.Breeze="breeze",t.Cascade="cascade",t.Drench="drench",t.Eclipse="eclipse",t.Flower="flower",t.Gleam="gleam",t.Gloom="gloom",t.Gust="gust",t.Ignite="ignite",t.Inferno="inferno",t.Seed="seed",t.Shade="shade",t.Soak="soak",t.Starfall="starfall",t.Tornado="tornado",t.Twinkle="twinkle",t))(s||{}),g=(t=>(t.Treat="treat",t.Vitamin="vitamin",t.Battle="battle",t))(g||{}),L=(t=>(t.Four="Four",t.Three="Three",t.Two="Two",t))(L||{}),p=(t=>(t.Train="train",t.Battle="battle",t))(p||{});const T=100,W=["amazwing","cherubud","flagoon","flarva","flitten","galephin","gloominnow","lopilot","luxureef","meadowisp","nebulon","oakindle","silten","smoldit","snakelit","specalf","spookecko","sproutide","voidixie","windeed","wispyre"],x={spookecko:{advantage:[],ascends:3,description:"This mysterious and eerie reptile lurks in the shadows, using its ghastly powers to frighten and confuse opponents.",disadvantage:[e.Light],element:[e.Dark],id:"spookecko",moves:[s.Gloom],name:"Spookecko",next:"shadile",stage:1,stats:{attack:2,defense:2,speed:1},tile:{x:0,y:0}},shadile:{advantage:[],ascends:4,description:"It lurks in the depths of the night, preying on the fears and weaknesses of its opponents with its sinister powers.",disadvantage:[e.Light],element:[e.Dark],id:"shadile",moves:[s.Shade],name:"Shadile",next:"spectraptor",previous:"spookecko",stage:2,stats:{attack:3,defense:2,speed:1},tile:{x:10,y:0}},spectraptor:{advantage:[],description:"If you feel a sudden chill, you may be experiencing the ghostly aura of this sinister raptor, silently stalking its prey.",disadvantage:[e.Light],element:[e.Dark],id:"spectraptor",moves:[s.Eclipse],name:"Spectraptor",previous:"shadile",stage:3,stats:{attack:4,defense:3,speed:1},tile:{x:20,y:0}},smoldit:{advantage:[e.Wind],ascends:7,description:"The smoldering embodiment of lingering spectral energy.",disadvantage:[e.Light,e.Water],element:[e.Dark,e.Fire],id:"smoldit",moves:[s.Blaze],name:"Smoldit",next:"embergeist",stage:1,stats:{attack:1,defense:1,speed:3},tile:{x:0,y:20}},embergeist:{advantage:[e.Wind],description:"Flickering, mysterious flames that haunt their surroundings with an ominous presence.",disadvantage:[e.Light,e.Water],element:[e.Dark,e.Fire],id:"embergeist",moves:[s.Inferno],name:"Embergeist",previous:"smoldit",stage:2,stats:{attack:2,defense:3,speed:4},tile:{x:10,y:20}},specalf:{advantage:[e.Water],ascends:5,description:"Awaiting the return of its doting parent, this bovine animal conceals itself beneath a veil of spectral flora.",disadvantage:[e.Light,e.Wind],element:[e.Dark,e.Earth],id:"specalf",moves:[s.Shade,s.Flower],name:"Specalf",next:"thornox",stage:1,stats:{attack:2,defense:3,speed:1},tile:{x:0,y:40}},thornox:{advantage:[e.Water],description:"It seeks to exact revenge on anyone it can find using its razor-sharp thorns.",disadvantage:[e.Light,e.Wind],element:[e.Dark,e.Earth],id:"thornox",moves:[s.Eclipse,s.Blossom],name:"Thornox",previous:"specalf",stage:2,stats:{attack:3,defense:4,speed:2},tile:{x:10,y:40}},voidixie:{advantage:[],ascends:7,description:"Few have witnessed its otherworldly aura, professing conflicting feelings of curiosity and trepidation.",disadvantage:[e.Dark,e.Light],element:[e.Dark,e.Light],id:"voidixie",moves:[s.Shade,s.Gleam],name:"Voidixie",next:"faeclipse",stage:1,stats:{attack:2,defense:1,speed:2},tile:{x:0,y:60}},faeclipse:{advantage:[],description:"Hauntingly sinister, menacing, and alluring. It has an aura of cosmic destruction.",disadvantage:[e.Dark,e.Light],element:[e.Dark,e.Light],id:"faeclipse",moves:[s.Eclipse,s.Starfall],name:"Faeclipse",previous:"voidixie",stage:2,stats:{attack:4,defense:1,speed:3},tile:{x:10,y:60}},gloominnow:{advantage:[e.Fire],ascends:5,description:"A glint from its shimmering, iridescent scales will catch your eye from deep below the waters.",disadvantage:[e.Earth,e.Light],element:[e.Dark,e.Water],id:"gloominnow",moves:[s.Gloom,s.Soak],name:"Gloominnow",next:"barrabyss",stage:1,stats:{attack:1,defense:1,speed:2},tile:{x:0,y:80}},barrabyss:{advantage:[e.Fire],ascends:8,description:"Be careful where you swim. Legend has it that when you see its eerie, glowing eyes, it's already too late for you.",disadvantage:[e.Earth,e.Light],element:[e.Dark,e.Water],id:"barrabyss",moves:[s.Shade,s.Drench],name:"Barrabyss",next:"umbracuda",previous:"gloominnow",stage:2,stats:{attack:2,defense:1,speed:3},tile:{x:10,y:80}},umbracuda:{advantage:[e.Fire],description:"Its sleek, etherial fins cascade through the water, appearing in and vanishing from the ocean at will.",disadvantage:[e.Earth,e.Light],element:[e.Dark,e.Water],id:"umbracuda",moves:[s.Eclipse,s.Cascade],name:"Umbracuda",previous:"barrabyss",stage:3,stats:{attack:4,defense:1,speed:4},tile:{x:20,y:80}},nebulon:{advantage:[e.Earth],ascends:6,description:"Often mistaken for an unidentified flying object, it has a markedly unassuming face.",disadvantage:[e.Fire,e.Light],element:[e.Dark,e.Wind],id:"nebulon",moves:[s.Shade,s.Gust],name:"Nebulon",next:"nebulisk",stage:1,stats:{attack:1,defense:4,speed:2},tile:{x:0,y:100}},nebulisk:{advantage:[e.Earth],description:"Seemingly extraterrestrial, it is highly skilled in piloting its sleek spacecraft.",disadvantage:[e.Fire,e.Light],element:[e.Dark,e.Wind],id:"nebulisk",moves:[s.Eclipse,s.Tornado],name:"Nebulisk",previous:"nebulon",stage:2,stats:{attack:3,defense:3,speed:3},tile:{x:10,y:100}},snakelit:{advantage:[e.Wind],ascends:4,description:"An emerald, fiery glow emits from this serpentine creature.",disadvantage:[e.Water],element:[e.Fire],id:"snakelit",moves:[s.Ignite],name:"Snakelit",next:"serpyro",stage:1,stats:{attack:2,defense:2,speed:2},tile:{x:0,y:120}},serpyro:{advantage:[e.Wind],ascends:8,description:"It uses the scorching jade flames emitting from its tail to extinguish its opponents.",disadvantage:[e.Water],element:[e.Fire],id:"serpyro",moves:[s.Blaze],name:"Serpyro",next:"pyroconda",previous:"snakelit",stage:2,stats:{attack:3,defense:2,speed:3},tile:{x:10,y:120}},pyroconda:{advantage:[e.Wind],description:"Majestic, some consider it a deity. Its fiery plumage exudes power and grace.",disadvantage:[e.Water],element:[e.Fire],id:"pyroconda",moves:[s.Inferno],name:"Pyroconda",previous:"serpyro",stage:3,stats:{attack:4,defense:2,speed:4},tile:{x:20,y:120}},oakindle:{advantage:[e.Water,e.Wind],ascends:5,description:"A small seedling engulfed in flames.",disadvantage:[],element:[e.Earth,e.Fire],id:"oakindle",moves:[s.Flower,s.Blaze],name:"Oakindle",next:"torchwood",stage:1,stats:{attack:3,defense:1,speed:1},tile:{x:0,y:140}},torchwood:{advantage:[e.Water,e.Wind],description:"It is fiercely loyal to mother nature, using her powers to protect those it considers vulnerable.",disadvantage:[],element:[e.Earth,e.Fire],id:"torchwood",moves:[s.Blossom,s.Inferno],name:"Torchwood",previous:"oakindle",stage:2,stats:{attack:4,defense:1,speed:1},tile:{x:10,y:140}},wispyre:{advantage:[e.Wind],description:"It's playful and mischievous, dazzling its opponents with sublime flames and whimsical charm.",disadvantage:[e.Dark,e.Water],element:[e.Fire,e.Light],id:"wispyre",moves:[s.Inferno,s.Starfall],name:"Wispyre",stage:1,stats:{attack:4,defense:3,speed:4},tile:{x:0,y:160}},flagoon:{advantage:[e.Fire,e.Wind],ascends:4,description:"It releases infernal steam to drive intruders away from its den.",disadvantage:[e.Earth],element:[e.Fire,e.Water],id:"flagoon",moves:[s.Ignite,s.Soak],name:"Flagoon",next:"blazesea",stage:1,stats:{attack:1,defense:2,speed:3},tile:{x:0,y:180}},blazesea:{advantage:[e.Fire,e.Wind],ascends:8,description:"It is widely known that Blazesea should not be approached. It unceasingly combusts as it maintains a cooling aura of water around its body.",disadvantage:[e.Earth],element:[e.Fire,e.Water],id:"blazesea",moves:[s.Blaze,s.Drench],name:"Blazesea",next:"infernocean",previous:"flagoon",stage:2,stats:{attack:3,defense:1,speed:2},tile:{x:10,y:180}},infernocean:{advantage:[e.Fire,e.Wind],description:"It is described as titanic, commanding the destructive power of roaring tides and wildfire.",disadvantage:[e.Earth],element:[e.Fire,e.Water],id:"infernocean",moves:[s.Inferno,s.Cascade],name:"Infernocean",previous:"blazesea",stage:3,stats:{attack:4,defense:2,speed:1},tile:{x:20,y:180}},flarva:{advantage:[e.Earth,e.Wind],ascends:3,description:"On a clear summer night, you can see the faint blue glow of Flarva swarming on the trees.",disadvantage:[e.Water],element:[e.Fire,e.Wind],id:"flarva",moves:[s.Ignite,s.Breeze],name:"Flarva",next:"chrysfire",stage:1,stats:{attack:1,defense:2,speed:1},tile:{x:0,y:200}},chrysfire:{advantage:[e.Earth,e.Wind],ascends:6,description:"Its shell is warm to the touch. Wildfire experts relocate Chrysfire away from forests before they hatch.",disadvantage:[e.Water],element:[e.Fire,e.Wind],id:"chrysfire",moves:[s.Blaze,s.Gust],name:"Chrysfire",next:"ignimoth",previous:"flarva",stage:2,stats:{attack:2,defense:4,speed:1},tile:{x:10,y:200}},ignimoth:{advantage:[e.Earth,e.Wind],description:"It flutters, trailed by delicate blue sparks. Many Chrysfire do not survive relocation, so it is said that an Ignimoth sighting brings one good luck.",disadvantage:[e.Water],element:[e.Fire,e.Wind],id:"ignimoth",moves:[s.Inferno,s.Tornado],name:"Ignimoth",previous:"chrysfire",stage:3,stats:{attack:4,defense:1,speed:2},tile:{x:20,y:200}},meadowisp:{advantage:[e.Water],description:"A stoic spirit of nature. If you look closely, you can find it tailing far behind you as you walk the forest trails.",disadvantage:[e.Wind],element:[e.Earth],id:"meadowisp",moves:[s.Blossom],name:"Meadowisp",stage:1,stats:{attack:4,defense:4,speed:1},tile:{x:0,y:220}},cherubud:{advantage:[e.Water],ascends:5,description:"It has a serene nature and captivating aroma that will bring peace to anyone in its presence.",disadvantage:[e.Dark,e.Wind],element:[e.Earth,e.Light],id:"cherubud",moves:[s.Flower,s.Gleam],name:"Cherubud",next:"angelily",stage:1,stats:{attack:1,defense:2,speed:2},tile:{x:0,y:240}},angelily:{advantage:[e.Water],description:"Its many faces resemble flowers that radiate a pure and heavenly aura. Culturally, it symbolizes a return to happiness.",disadvantage:[e.Dark,e.Wind],element:[e.Earth,e.Light],id:"angelily",moves:[s.Blossom,s.Starfall],name:"Angelily",previous:"cherubud",stage:2,stats:{attack:2,defense:3,speed:3},tile:{x:10,y:240}},sproutide:{advantage:[e.Fire,e.Water],ascends:7,description:"A playful dragon hatchling born from a river, embodying the energy of nature.",disadvantage:[e.Wind],element:[e.Earth,e.Water],id:"sproutide",moves:[s.Flower,s.Drench],name:"Sproutide",next:"floriver",stage:1,stats:{attack:2,defense:1,speed:4},tile:{x:0,y:260}},floriver:{advantage:[e.Fire,e.Water],description:"A revered deity of the river. It manipulates the flow of water where it swims, growing lily pads in its wake.",disadvantage:[e.Wind],element:[e.Earth,e.Water],id:"floriver",moves:[s.Blossom,s.Cascade],name:"Floriver",previous:"sproutide",stage:2,stats:{attack:4,defense:2,speed:2},tile:{x:10,y:260}},windeed:{advantage:[e.Earth,e.Water],ascends:7,description:"It hides among planted beetroots, zipping into the sky before it is picked.",disadvantage:[e.Fire],element:[e.Earth,e.Wind],id:"windeed",moves:[s.Flower,s.Gust],name:"Windeed",next:"zephyroot",stage:1,stats:{attack:1,defense:3,speed:3},tile:{x:0,y:280}},zephyroot:{advantage:[e.Earth,e.Water],description:"A spring festival celebrates the migration of Zephyroot. They carry themselves on the air with a fan of leaves.",disadvantage:[e.Fire],element:[e.Earth,e.Wind],id:"zephyroot",moves:[s.Blossom,s.Tornado],name:"Zephyroot",previous:"windeed",stage:2,stats:{attack:2,defense:4,speed:4},tile:{x:10,y:280}},flitten:{advantage:[],ascends:7,description:"It's known for its mischievous, playful nature. It manipulates your dreams, hoping to be fed when you wake.",disadvantage:[e.Dark],element:[e.Light],id:"flitten",moves:[s.Gleam],name:"Flitten",next:"glimmew",stage:1,stats:{attack:3,defense:2,speed:2},tile:{x:0,y:300}},glimmew:{advantage:[],description:"Nocturnal, its luminescent fur glimmers in the moonlight, charming opponents with its graceful movements.",disadvantage:[e.Dark],element:[e.Light],id:"glimmew",moves:[s.Starfall],name:"Glimmew",previous:"flitten",stage:2,stats:{attack:4,defense:2,speed:3},tile:{x:10,y:300}},silten:{advantage:[e.Fire],ascends:4,description:"It posesses a protective shell that provides for it remarkable resilience and adaptability.",disadvantage:[e.Dark,e.Earth],element:[e.Light,e.Water],id:"silten",moves:[s.Twinkle,s.Soak],name:"Silten",next:"boglow",stage:1,stats:{attack:1,defense:3,speed:2},tile:{x:0,y:320}},boglow:{advantage:[e.Fire],ascends:7,description:"A tiny luminescent creature with a resilient body. It thrives in extreme aquatic environments.",disadvantage:[e.Dark,e.Earth],element:[e.Light,e.Water],id:"boglow",moves:[s.Gleam,s.Drench],name:"Boglow",next:"gleamoss",previous:"silten",stage:2,stats:{attack:2,defense:4,speed:2},tile:{x:10,y:320}},gleamoss:{advantage:[e.Fire],description:"Its shimmering moss-like exterior grants it the ability to regenerate and endure harsh environments. It is not visible to the naked eye.",disadvantage:[e.Dark,e.Earth],element:[e.Light,e.Water],id:"gleamoss",moves:[s.Starfall,s.Cascade],name:"Gleamoss",previous:"boglow",stage:3,stats:{attack:3,defense:4,speed:1},tile:{x:20,y:320}},amazwing:{advantage:[e.Earth],ascends:5,description:"Tales of cupid can usually be attributed to Amazwing. It spreads love and joy as it flies.",disadvantage:[e.Dark,e.Fire],element:[e.Light,e.Wind],id:"amazwing",moves:[s.Twinkle,s.Breeze],name:"Amazwing",next:"featherall",stage:1,stats:{attack:1,defense:1,speed:4},tile:{x:0,y:340}},featherall:{advantage:[e.Earth],ascends:8,description:"It enchants the hearts of those it pierces with its tail feathers.",disadvantage:[e.Dark,e.Fire],element:[e.Light,e.Wind],id:"featherall",moves:[s.Gleam,s.Gust],name:"Featherall",next:"enchantalon",previous:"amazwing",stage:2,stats:{attack:2,defense:2,speed:4},tile:{x:10,y:340}},enchantalon:{advantage:[e.Earth],description:"It is a graceful and affectionate parter, but it lulls its enemies into a false sense of security with its enchanting melodies.",disadvantage:[e.Dark,e.Fire],element:[e.Light,e.Wind],id:"enchantalon",moves:[s.Starfall,s.Tornado],name:"Enchantalon",previous:"featherall",stage:3,stats:{attack:3,defense:3,speed:4},tile:{x:20,y:340}},luxureef:{advantage:[e.Fire],ascends:7,description:"Vibrant coral climbs its body. It is capable of producing captivating displays of bioluminescence.",disadvantage:[e.Earth],element:[e.Water],id:"luxureef",moves:[s.Drench],name:"Luxureef",next:"coraluxe",stage:1,stats:{attack:2,defense:3,speed:2},tile:{x:0,y:360}},coraluxe:{advantage:[e.Fire],description:"It can manipulate the flow of water currents, which often results in conflict with Floriver. Whirlpools form where they clash.",disadvantage:[e.Earth],element:[e.Water],id:"coraluxe",moves:[s.Cascade],name:"Coraluxe",previous:"luxureef",stage:2,stats:{attack:3,defense:4,speed:3},tile:{x:10,y:360}},galephin:{advantage:[e.Earth,e.Fire],ascends:7,description:"Its sleek dolphin-like body allows it to soar through the sky. Funnel clouds form in its trail.",disadvantage:[],element:[e.Water,e.Wind],id:"galephin",moves:[s.Drench,s.Gust],name:"Galephin",next:"typhorca",stage:1,stats:{attack:3,defense:1,speed:3},tile:{x:0,y:380}},typhorca:{advantage:[e.Earth,e.Fire],description:"Gliding through the air with agility, it uses its windswept tail to create powerful gusts and summon storms at sea.",disadvantage:[],element:[e.Water,e.Wind],id:"typhorca",moves:[s.Cascade,s.Tornado],name:"Typhorca",previous:"galephin",stage:2,stats:{attack:3,defense:1,speed:4},tile:{x:10,y:380}},lopilot:{advantage:[e.Earth],ascends:7,description:"Its large ears allow it to effortlessly navigate the winds. Lost travelers are guided by Lopilot to safety.",disadvantage:[e.Fire],element:[e.Wind],id:"lopilot",moves:[s.Gust],name:"Lopilot",next:"aviare",stage:1,stats:{attack:2,defense:2,speed:3},tile:{x:0,y:400}},aviare:{advantage:[e.Earth],description:"A skilled pilot of the skies, it is rare to see Aviare on solid ground. Its fur has evolved to resemble fluffy clouds.",disadvantage:[e.Fire],element:[e.Wind],id:"aviare",moves:[s.Tornado],name:"Aviare",previous:"lopilot",stage:2,stats:{attack:3,defense:2,speed:4},tile:{x:10,y:400}}},D=(t,a)=>{const n=t[a];return{...t,[a]:{...n,cooldowns:{}}}},G=(t=1)=>Math.ceil(t*2/5)+t+4,y=(t,a)=>Math.floor(Math.random()*(a-t+1)+t),_=(t,a)=>a,q=()=>Math.random()-.5,z=(t,a=10)=>{const n=Array(a).fill(null).map(_);return n.sort(q),n.slice(0,t)},O=t=>{const a=W[t],n=x[a];return{...n,stats:{...n.stats,hp:G(1),level:1,xp:0}}},X=()=>{const t=y(0,W.length-1);return O(t)},Z=(t=3)=>z(t,W.length).map(O),J=()=>Z(1),Y={one:{id:"one",name:"one",type:g.Battle},two:{id:"two",name:"two",type:g.Treat},three:{id:"three",name:"three",type:g.Vitamin},four:{id:"four",name:"four",type:g.Treat},five:{id:"five",name:"five",type:g.Battle}},C=Object.values(Y),K=t=>C[t],Q=(t=3)=>z(t,C.length).map(K),M=()=>Q(3),R={[s.Blaze]:{element:e.Fire,label:"Blaze",level:2},[s.Blossom]:{element:e.Earth,label:"Blossom",level:3},[s.Breeze]:{element:e.Wind,label:"Breeze",level:1},[s.Cascade]:{element:e.Water,label:"Cascade",level:3},[s.Drench]:{element:e.Water,label:"Drench",level:2},[s.Eclipse]:{element:e.Dark,label:"Eclipse",level:3},[s.Flower]:{element:e.Earth,label:"Flower",level:2},[s.Gleam]:{element:e.Light,label:"Gleam",level:2},[s.Gloom]:{element:e.Dark,label:"Gloom",level:1},[s.Gust]:{element:e.Wind,label:"Gust",level:2},[s.Ignite]:{element:e.Fire,label:"Ignite",level:1},[s.Inferno]:{element:e.Fire,label:"Inferno",level:3},[s.Seed]:{element:e.Earth,label:"Seed",level:1},[s.Shade]:{element:e.Dark,label:"Shade",level:2},[s.Soak]:{element:e.Water,label:"Soak",level:2},[s.Starfall]:{element:e.Light,label:"Starfall",level:3},[s.Tornado]:{element:e.Wind,label:"Tornado",level:3},[s.Twinkle]:{element:e.Light,label:"Twinkle",level:1}},S=30,m=({event:t,game:a,id:n})=>{if(n){const i=a.players[n];i.events.length===S&&i.events.shift(),i.events.push(t)}else a.events.length===S&&a.events.shift(),a.events.push(t)},ee=({event:t,game:a,id:n})=>{const i=l=>m({game:a,event:t,id:l}),r=Object.keys(a.players),o=r.indexOf(n);r.splice(o,1),r.forEach(i)},b=({events:t,game:a,id:n})=>{m({game:a,event:t.public}),m({game:a,event:t.player,id:n}),ee({game:a,event:t.rival,id:n})},te=(t,a)=>n=>{const i=t.players[a];if(!i)return;const{target:r}=i;if(!r)return;const[o]=i.buds;if(!o)return;const{stats:l}=o,d=t.players[r];if(!(d!=null&&d.buds.length))return;const[c]=d.buds,{advantage:v,disadvantage:u,stats:f}=c,{hp:A=1,defense:w}=f,{attack:P}=l,{element:F,label:N}=R[n],I=v.includes(F),B=u.includes(F),j=y(0,255),U=y(0,2),E=j<=U;let h=P;I&&(h*=.5),B&&(h*=2),E&&(h*=1.5);const V=Math.ceil(h>=w?h*2-w:h*h/w);f.hp=A-V;const H=[`${o.name} used ${N} on ${c.name}!`,E&&"Critical hit!",I&&"It's ineffective...",B&&"It's effective!"].filter(Boolean).join(" ");m({event:H,game:t})},ae=1,se=(t,a)=>()=>{const n=t.players[a];if(!(n!=null&&n.buds.length))return;const[{moves:{length:i},name:r,stats:o}]=n.buds,{level:l=1,xp:d=0}=o;o.xp=d+ae*(1/i);const c=Math.ceil((l*2-1)*1.2);o.xp>=c&&(o.level=l+1,o.hp=G(o.level),b({game:t,events:{player:`${r} leveled up to ${o.level}!`,public:`${r} leveled up to ${o.level}!`,rival:`Rival's ${r} leveled up to ${o.level}!`},id:a}))},ne=(t,[a,n])=>{const{cooldowns:i,complete:r}=t,o=a;return n?{complete:r,cooldowns:{...i,[o]:n-1}}:{cooldowns:i,complete:[...r,o]}},ie=t=>R[t].element,re=(t,a)=>{const{phase:n,players:i}=t,r=i[a];if(!r)return;const{complete:o,cooldowns:l}=Object.entries(r.cooldowns).reduce(ne,{cooldowns:{},complete:[]});t.players[a].cooldowns=l;const d=o.map(ie);if(n===p.Train){if(!(r!=null&&r.buds.length))return;const[{stats:{level:c=0}}]=r.buds;if(c<T){const u=se(t,a);o.forEach(u)}const{sounds:v}=r;t.players[a].sounds=[...v,...d]}else if(n===p.Battle){const c=te(t,a);o.forEach(c),t.sounds=[...t.sounds,...d]}},oe=(t,a)=>{const{stats:{hp:n=0}}=a,{nextDefeatedBuds:i,nextBuds:r}=t;return n<=0?{...t,nextDefeatedBuds:[...i,a]}:{...t,nextBuds:[...r,a]}},le=(t,a)=>{const n=t.players[a],{buds:i,defeatedBuds:r}=n,{nextBuds:o,nextDefeatedBuds:l}=[...i].reduce(oe,{nextBuds:[],nextDefeatedBuds:[]});n.buds=o,n.defeatedBuds=[...r,...l];const d=({name:c})=>m({game:t,event:`${c} was defeated!`});l.forEach(d)},de=({gameOver:t})=>t,ce=(t,a)=>{const{[a]:n,...i}=t.players;if(!Object.values(i).every(de)){const o=(n==null?void 0:n.buds.length)===0;o&&!n.gameOver&&m({game:t,event:"A player whited out!"}),n.gameOver=o}},pe=3,ue=(t,a)=>{const n=t.players[a];if(n&&(n.lastEvent=t.duration,n.buds.length<pe)){const i=X();n.buds=[...n.buds,i],b({game:t,events:{player:`You befriended ${i.name}!`,public:`${i.name} was befriended!`,rival:`Rival befriended ${i.name}!`},id:a})}},he=(t,a)=>{const n=y(6e4,12e4),{duration:i,players:r}=t,o=r[a],{lastEvent:l}=o;i-l>n&&ue(t,a)},k=(t,a)=>{const n=a.indexOf(t),i=[...a];i.splice(n,1);const r=y(0,i.length-1);return i[r]},ge=t=>(a,n)=>{const{gameOver:i}=t.players[n],r=i?"LOST":"WON";return{...a,[n]:r}},me=t=>(a,n)=>{const i=(r,[o,l])=>{const{target:d}=l;return d!==n?r:{...r,[o]:{...l,target:k(o,t)}}};return Object.entries(a).reduce(i,a)},ve=t=>(a,n,i,r)=>{const o=a[n];return o.target===t&&(o.target=k(n,r)),a},$=(t,a)=>({buds:J(),cooldowns:{},defeatedBuds:[],events:[],gameOver:!1,id:t,inventory:M(),lastEvent:Rune.gameTime()/1e3,name:t,ping:0,sounds:[],stars:3e3,target:k(t,a)}),fe=(t,a,n,i)=>({...t,[a]:$(a,i)}),ye=t=>(a,n)=>{re(t,n);const{phase:i,players:r}=t;return i===p.Train?he(t,n):i===p.Battle&&(le(t,n),ce(t,n)),r[n].gameOver?[...a,n]:a};Rune.initLogic({minPlayers:1,maxPlayers:3,setup:t=>({battleType:L.Four,duration:0,ended:!1,events:[],phase:p.Train,phases:{[p.Train]:60*3*1e3},players:t.reduce(fe,{}),playerIds:t,sounds:[]}),events:{playerJoined:(t,{game:a})=>{if(a.playerIds.push(t),a.players[t]=$(t,a.playerIds),a.playerIds.length>1){const[n]=a.playerIds;a.players[n].target||(a.players[n].target=k(n,a.playerIds))}},playerLeft:(t,{game:a})=>{const n=a.playerIds.indexOf(t);a.playerIds.splice(n,1),delete a.players[t];const{players:i,playerIds:r}=a,o=ve(t);a.players=r.reduce(o,i)}},actions:{attack:({id:t,move:a,speed:n},{game:i})=>{const r=6-n;i.phase===p.Train?i.players[t].cooldowns[a]=r:i.players[t].cooldowns={[a]:r}},battle:(t,{game:a})=>{a.phase=p.Battle,a.players=a.playerIds.reduce(D,a.players)},clearSounds:({id:t,sounds:a},{game:n})=>{const{phase:i}=n,r=o=>!a.includes(o);if(i===p.Battle)n.sounds=n.sounds.filter(r);else{const{sounds:o}=n.players[t];n.players[t].sounds=o.filter(r)}},train:(t,{game:a})=>{a.phase=p.Train},ascend:({id:t},{game:a})=>{const{players:n}=a,i=n[t],[r]=i.buds;if(!r)return;const{ascends:o=T,next:l}=r;if(!l)return;const{stats:{hp:d,level:c=1,xp:v}}=r;if(c<o)return;const u={...x[l],stats:{...x[l].stats,hp:d,level:c,xp:v}};i.buds[0]=u,i.cooldowns={};const f=`${r.name} ascended to ${u.name}!`;b({game:a,events:{player:f,public:f,rival:`Rival's ${r.name} ascended to ${u.name}!`},id:t})},switch:({id:t},{game:a})=>{const n=a.players[t],{cooldowns:i}=n;if(!!Object.keys(i).length)return;const o=n.buds.shift();if(o){n.buds.push(o);const[l]=n.buds,d=`${o==null?void 0:o.name} switched with ${l==null?void 0:l.name}!`;b({game:a,events:{player:d,public:d,rival:`Rival's ${d}`},id:t})}},target:({id:t,target:a},{game:n})=>{n.players[t].target=a}},update:({allPlayerIds:t,game:a})=>{a.duration=Rune.gameTime();const{duration:n,phases:{[p.Train]:i},playerIds:r}=a;n===i&&(a.phase=p.Battle,a.players=r.reduce(D,a.players));const o=ye(a),l=t.reduce(o,[]);if(a.phase===p.Battle)if(l.length===t.length-1){a.ended=!0;const c=ge(a);Rune.gameOver({players:t.reduce(c,{})})}else{const c=me(a.playerIds);a.players=l.reduce(c,a.players)}}});export{L as B,e as E,p as P,G as g,R as m};
